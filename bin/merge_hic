#!/usr/bin/env python

import argparse
import os.path
from kaic.data.genomic import Hic
from kaic.tools.files import copy_or_expand
import logging
logging.basicConfig(level=logging.DEBUG)

if __name__ == '__main__':
    parser = argparse.ArgumentParser()

    parser.add_argument(
        'hic',
        nargs='+',
        help='''Input Hic files'''
    )

    parser.add_argument(
        'output',
        help='''Output binned Hic object'''
    )

    args = parser.parse_args()

    logging.info("Copying %s" % args.output)
    base_path = copy_or_expand(args.hic.pop(0), args.output)
    merged = Hic(base_path)

    for path in args.hic:
        logging.info("Merging %s" % path)
        input_path = os.path.expanduser(path)
        hic = Hic(input_path)
        merged.merge(hic)
        hic.close()

    merged.close()
    logging.info("Done")
