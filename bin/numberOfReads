#!/usr/bin/env python

import argparse
from kaic.tools.hic import load_mirny_binned_hic
import logging
logging.basicConfig(level=logging.DEBUG)

if __name__ == '__main__':
    parser = argparse.ArgumentParser();
    
    parser.add_argument(
        'hic',
        help='''Hi-C file'''
    );
    
    parser.add_argument(
        'genome',
        help='''Genome object file'''
    );
    
    parser.add_argument(
        '-res', '--resolution', dest='resolution',
        type=int,
        help='''Resolution (binning distance) of Hi-C maps''',
        required=True
    )
   
    args = parser.parse_args()
    
    hic = load_mirny_binned_hic(args.hic, args.genome, args.resolution)
    
    s = 0
    for chr1, chr2 in hic.data:
        data = hic.data[(chr1, chr2)].getData()
        
        if chr1 == chr2:
            for i in range(0,data.shape[0]):
                for j in range(i,data.shape[1]):
                    s += data[i,j]
        else:
            for i in range(0,data.shape[0]):
                for j in range(0,data.shape[1]):
                    s += data[i,j]
    print s